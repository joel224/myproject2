{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/mockData.ts"],"sourcesContent":["import type { Patient, Appointment, TreatmentPlan, ProgressNote, StaffMember, Invoice } from './types';\n\nexport const mockPatients: Patient[] = [\n  { id: 'pat1', name: 'Alice Wonderland', email: 'alice@example.com', dateOfBirth: '1990-05-15', phone: '555-0101' },\n  { id: 'pat2', name: 'Bob The Builder', email: 'bob@example.com', dateOfBirth: '1985-11-20', phone: '555-0102' },\n  { id: 'pat3', name: 'Charlie Brown', email: 'charlie@example.com', dateOfBirth: '2000-01-30', phone: '555-0103' },\n];\n\nexport const mockStaff: StaffMember[] = [\n  { id: 'doc1', name: 'Dr. Loji', role: 'Dentist', email: 'drloji@example.com' },\n  { id: 'staff1', name: 'Sarah Miller', role: 'Receptionist', email: 'sarah@example.com' },\n  { id: 'hyg1', name: 'Mike Ross', role: 'Hygienist', email: 'mike@example.com' },\n];\n\nexport const mockAppointments: Appointment[] = [\n  { id: 'apt1', patientId: 'pat1', patientName: 'Alice Wonderland', doctorId: 'doc1', doctorName: 'Dr. Loji', date: new Date().toISOString().split('T')[0], time: '10:00 AM', type: 'Check-up', status: 'Scheduled' },\n  { id: 'apt2', patientId: 'pat2', patientName: 'Bob The Builder', doctorId: 'doc1', doctorName: 'Dr. Loji', date: new Date(Date.now() + 86400000).toISOString().split('T')[0], time: '02:30 PM', type: 'Cleaning', status: 'Confirmed' },\n  { id: 'apt3', patientId: 'pat1', patientName: 'Alice Wonderland', doctorId: 'doc1', doctorName: 'Dr. Loji', date: new Date(Date.now() - 86400000 * 5).toISOString().split('T')[0], time: '09:00 AM', type: 'Filling', status: 'Completed' },\n];\n\nexport const mockTreatmentPlans: TreatmentPlan[] = [\n  {\n    id: 'tp1',\n    patientId: 'pat1',\n    doctorId: 'doc1',\n    title: 'Comprehensive Oral Care Plan',\n    procedures: [\n      { id: 'proc1', name: 'Full Mouth X-Ray', cost: 150 },\n      { id: 'proc2', name: 'Deep Cleaning (Scaling & Root Planing)', cost: 400 },\n      { id: 'proc3', name: 'Fluoride Treatment', cost: 50 },\n    ],\n    startDate: new Date(Date.now() - 86400000 * 10).toISOString().split('T')[0],\n    status: 'Active',\n    totalCost: 600,\n  },\n  {\n    id: 'tp2',\n    patientId: 'pat2',\n    doctorId: 'doc1',\n    title: 'Implant Placement - Phase 1',\n    procedures: [{ id: 'proc4', name: 'Dental Implant Surgery (Single Tooth)', cost: 2000 }],\n    startDate: new Date().toISOString().split('T')[0],\n    status: 'Active',\n    totalCost: 2000,\n  },\n];\n\nexport const mockProgressNotes: ProgressNote[] = [\n  {\n    id: 'pn1',\n    patientId: 'pat1',\n    treatmentPlanId: 'tp1',\n    doctorId: 'doc1',\n    date: new Date(Date.now() - 86400000 * 9).toISOString().split('T')[0],\n    time: '10:30 AM',\n    note: 'Initial consultation. Discussed treatment plan. Patient agreeable. Full mouth X-rays taken.',\n    images: [{ id: 'img1', url: 'https://placehold.co/300x200.png', caption: 'X-Ray Left Side' }],\n    progressStage: 'Initial Assessment',\n  },\n  {\n    id: 'pn2',\n    patientId: 'pat1',\n    treatmentPlanId: 'tp1',\n    doctorId: 'doc1',\n    date: new Date(Date.now() - 86400000 * 2).toISOString().split('T')[0],\n    time: '11:00 AM',\n    note: 'Deep cleaning performed on upper quadrant. Patient tolerated well. Advised on post-op care.',\n    progressStage: 'Procedure Day 1',\n  },\n];\n\nexport const mockInvoices: Invoice[] = [\n    { \n        id: 'inv1', \n        patientId: 'pat1', \n        date: new Date(Date.now() - 86400000 * 10).toISOString().split('T')[0], \n        dueDate: new Date(Date.now() + 86400000 * 20).toISOString().split('T')[0],\n        items: [\n            { description: 'Full Mouth X-Ray', quantity: 1, unitPrice: 150, totalPrice: 150 },\n            { description: 'Deep Cleaning (Scaling & Root Planing)', quantity: 1, unitPrice: 400, totalPrice: 400 },\n        ], \n        totalAmount: 550, \n        amountPaid: 200, \n        status: 'Partial' \n    },\n    { \n        id: 'inv2', \n        patientId: 'pat2', \n        date: new Date().toISOString().split('T')[0], \n        dueDate: new Date(Date.now() + 86400000 * 30).toISOString().split('T')[0],\n        items: [\n            { description: 'Dental Implant Surgery (Single Tooth) - Deposit', quantity: 1, unitPrice: 1000, totalPrice: 1000 },\n        ], \n        totalAmount: 1000, \n        amountPaid: 0, \n        status: 'Pending' \n    },\n];\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/mockServerDb.ts"],"sourcesContent":["\n// src/lib/mockServerDb.ts\nimport type { Appointment, TreatmentPlan, ProgressNote, Invoice, StaffMember, PaymentTransaction, Conversation, Message, Patient as PatientType } from './types';\nimport {\n  mockAppointments as initialAppointments,\n  mockTreatmentPlans as initialTreatmentPlans,\n  mockProgressNotes as initialProgressNotes,\n  mockInvoices as initialInvoices,\n  mockStaff as initialStaffCollection, // Renamed to avoid conflict\n  mockPatients as initialPatients\n} from './mockData';\nimport type { NextRequest } from 'next/server';\nimport { NextResponse } from 'next/server';\n\nexport interface UserAuth {\n  id: string;\n  name: string;\n  email: string;\n  passwordHash?: string;\n  role: 'patient' | 'doctor' | 'staff' | 'hygienist' | 'admin' | 'assistant';\n  resetToken?: string;\n  resetTokenExpiry?: Date;\n  dateOfBirth?: string;\n  phone?: string;\n  age?: number;\n  medicalRecords?: string;\n  xrayImageUrls?: string[];\n  hasDiabetes?: boolean;\n  hasHighBloodPressure?: boolean;\n  hasStrokeOrHeartAttackHistory?: boolean;\n  hasBleedingDisorders?: boolean;\n  hasAllergy?: boolean;\n  allergySpecifics?: string;\n  hasAsthma?: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport function generateId(prefix: string = 'id_') {\n  return prefix + Date.now().toString(36) + Math.random().toString(36).substring(2, 7);\n}\n\nlet users: UserAuth[] = [];\n\ninitialStaffCollection.forEach(staffMember => {\n  let userAuthRole: UserAuth['role'] = 'staff';\n  if (staffMember.role === 'Dentist') userAuthRole = 'doctor';\n  else if (staffMember.role === 'Hygienist') userAuthRole = 'hygienist';\n  else if (staffMember.role === 'Assistant') userAuthRole = 'assistant';\n  else if (staffMember.role === 'Admin') userAuthRole = 'admin';\n\n  users.push({\n    id: staffMember.id,\n    name: staffMember.name,\n    email: staffMember.email,\n    role: userAuthRole,\n    passwordHash: `$2a$10$mockPasswordFor${staffMember.id}`,\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  });\n});\n\ninitialPatients.forEach(patient => {\n  users.push({\n    id: patient.id,\n    name: patient.name,\n    email: patient.email,\n    role: 'patient',\n    phone: patient.phone,\n    dateOfBirth: patient.dateOfBirth,\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  });\n});\n\n\nlet appointments: Appointment[] = JSON.parse(JSON.stringify(initialAppointments));\nlet treatmentPlans: TreatmentPlan[] = JSON.parse(JSON.stringify(initialTreatmentPlans));\nlet progressNotes: ProgressNote[] = JSON.parse(JSON.stringify(initialProgressNotes));\nlet invoices: Invoice[] = JSON.parse(JSON.stringify(initialInvoices));\n// Removed: let staff: StaffMember[] = JSON.parse(JSON.stringify(initialStaff));\nlet paymentTransactions: PaymentTransaction[] = [];\nlet clinicWaitTime = { text: \"<10 mins\", updatedAt: new Date().toISOString() };\n\n// Mock conversations and messages\nlet conversations: Conversation[] = [\n  {\n    id: 'convo1',\n    patientId: 'pat1',\n    staffId: 'staff1', \n    patientName: initialPatients.find(p => p.id === 'pat1')?.name,\n    patientAvatarUrl: `https://placehold.co/40x40.png?text=${initialPatients.find(p => p.id === 'pat1')?.name?.charAt(0)}`,\n    lastMessageText: \"Hi, can I reschedule my appointment?\",\n    lastMessageTimestamp: new Date(Date.now() - 3600000 * 2).toISOString(), \n    unreadCountForStaff: 1,\n  },\n  {\n    id: 'convo2',\n    patientId: 'pat2',\n    staffId: 'staff1',\n    patientName: initialPatients.find(p => p.id === 'pat2')?.name,\n    patientAvatarUrl: `https://placehold.co/40x40.png?text=${initialPatients.find(p => p.id === 'pat2')?.name?.charAt(0)}`,\n    lastMessageText: \"Thank you for the reminder!\",\n    lastMessageTimestamp: new Date(Date.now() - 86400000).toISOString(), \n    unreadCountForStaff: 0,\n  },\n  {\n    id: 'convo3',\n    patientId: 'pat3',\n    staffId: 'staff1',\n    patientName: initialPatients.find(p => p.id === 'pat3')?.name,\n    patientAvatarUrl: `https://placehold.co/40x40.png?text=${initialPatients.find(p => p.id === 'pat3')?.name?.charAt(0)}`,\n    lastMessageText: \"Is parking available at the clinic?\",\n    lastMessageTimestamp: new Date(Date.now() - 86400000 * 2).toISOString(), \n    unreadCountForStaff: 1,\n  }\n];\n\nlet messages: Message[] = [\n  {\n    id: generateId('msg_'),\n    conversationId: 'convo1',\n    senderId: 'pat1',\n    senderRole: 'patient',\n    text: \"Hi, can I reschedule my appointment scheduled for tomorrow?\",\n    timestamp: new Date(Date.now() - 3600000 * 2 - 60000).toISOString(), \n  },\n  {\n    id: generateId('msg_'),\n    conversationId: 'convo1',\n    senderId: 'staff1', \n    senderRole: 'staff',\n    text: \"Hello Alice, certainly! Which day and time would work best for you?\",\n    timestamp: new Date(Date.now() - 3600000 * 2).toISOString(), \n  },\n  {\n    id: generateId('msg_'),\n    conversationId: 'convo2',\n    senderId: 'staff1',\n    senderRole: 'staff',\n    text: \"Hi Bob, just a friendly reminder about your appointment tomorrow at 2:30 PM.\",\n    timestamp: new Date(Date.now() - 86400000 - 3600000).toISOString(), \n  },\n  {\n    id: generateId('msg_'),\n    conversationId: 'convo2',\n    senderId: 'pat2',\n    senderRole: 'patient',\n    text: \"Thank you for the reminder!\",\n    timestamp: new Date(Date.now() - 86400000).toISOString(), \n  },\n   {\n    id: generateId('msg_'),\n    conversationId: 'convo3',\n    senderId: 'pat3',\n    senderRole: 'patient',\n    text: \"Is parking available at the clinic?\",\n    timestamp: new Date(Date.now() - 86400000 * 2).toISOString(), \n  }\n];\n\n\nexport const db = {\n  users,\n  appointments,\n  treatmentPlans,\n  progressNotes,\n  invoices,\n  clinicWaitTime,\n  // staff, // Removed staff from here\n  paymentTransactions,\n  conversations,\n  messages,\n};\n\n\nexport async function authorize(req: NextRequest, requiredRole?: UserAuth['role'] | UserAuth['role'][]) {\n  const mockSessionToken = req.cookies.get('sessionToken')?.value;\n  if (!mockSessionToken) {\n    return { authorized: false, user: null, error: NextResponse.json({ message: 'Unauthorized: No session token' }, { status: 401 }) };\n  }\n  const [userIdFromToken, userRoleFromToken] = mockSessionToken.split(':');\n  const user = db.users.find(u => u.id === userIdFromToken);\n\n  if (!user) {\n    return { authorized: false, user: null, error: NextResponse.json({ message: 'Unauthorized: Invalid session' }, { status: 401 }) };\n  }\n\n  const rolesToCheck = Array.isArray(requiredRole) ? requiredRole : (requiredRole ? [requiredRole] : []);\n\n  if (rolesToCheck.length > 0 && !rolesToCheck.includes(user.role)) {\n    return { authorized: false, user: null, error: NextResponse.json({ message: 'Forbidden: Insufficient permissions' }, { status: 403 }) };\n  }\n  return { authorized: true, user: user, error: null };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 458, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/patients/%5BpatientId%5D/progress-notes/route.ts"],"sourcesContent":["// src/app/api/patients/[patientId]/progress-notes/route.ts\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { z } from 'zod';\nimport { db, generateId, authorize } from '@/lib/mockServerDb';\nimport type { ProgressNote, ProgressNoteImage } from '@/lib/types';\n\nconst progressNoteImageSchema = z.object({\n  // For mock, we'll assume URL is provided directly or handled by a separate upload endpoint.\n  // In real app, this might be a file upload.\n  id: z.string().optional(),\n  url: z.string().url(\"Image URL must be valid\"),\n  caption: z.string().optional(),\n});\n\nconst progressNoteSchema = z.object({\n  doctorId: z.string().min(1, \"Doctor ID is required\"),\n  treatmentPlanId: z.string().optional(),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  time: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, \"Time must be in HH:MM (24h) format or HH:MM AM/PM\"), // Adjust regex if needed\n  note: z.string().min(1, \"Note content is required\"),\n  images: z.array(progressNoteImageSchema).optional(),\n  progressStage: z.string().optional(),\n});\n\ninterface ProgressNoteRouteParams {\n  params: {\n    patientId: string;\n  }\n}\n\nexport async function GET(request: NextRequest, { params }: ProgressNoteRouteParams) {\n  // const authResult = await authorize(request, 'doctor');\n  // if (!authResult.authorized || !authResult.user) { return authResult.error; }\n  const { patientId } = params;\n\n  if (!db.users.some(u => u.id === patientId && u.role === 'patient')) {\n    return NextResponse.json({ message: \"Patient not found\" }, { status: 404 });\n  }\n\n  const notes = db.progressNotes.filter(pn => pn.patientId === patientId);\n  return NextResponse.json(notes, { status: 200 });\n}\n\nexport async function POST(request: NextRequest, { params }: ProgressNoteRouteParams) {\n  // const authResult = await authorize(request, 'doctor');\n  // if (!authResult.authorized || !authResult.user) { return authResult.error; }\n  const { patientId } = params;\n  \n  if (!db.users.some(u => u.id === patientId && u.role === 'patient')) {\n    return NextResponse.json({ message: \"Patient not found\" }, { status: 404 });\n  }\n\n  try {\n    // For actual file uploads, you'd use `request.formData()`\n    // For this mock, we assume JSON body with image URLs.\n    const body = await request.json();\n    const validation = progressNoteSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json({ message: \"Validation failed\", errors: validation.error.flatten().fieldErrors }, { status: 400 });\n    }\n    \n    const data = validation.data;\n\n    if (!db.users.some(u => u.id === data.doctorId && u.role === 'doctor')) {\n         return NextResponse.json({ message: \"Doctor not found\" }, { status: 404 });\n    }\n    if (data.treatmentPlanId && !db.treatmentPlans.some(tp => tp.id === data.treatmentPlanId)) {\n        return NextResponse.json({ message: \"Treatment plan not found\" }, { status: 404 });\n    }\n\n\n    const newNote: ProgressNote = {\n      id: generateId('pn_'),\n      patientId,\n      ...data,\n      images: data.images?.map(img => ({ ...img, id: img.id || generateId('img_') })) || [],\n    };\n\n    db.progressNotes.push(newNote);\n    return NextResponse.json(newNote, { status: 201 });\n\n  } catch (error) {\n    console.error('Error creating progress note:', error);\n    // If error is due to JSON parsing for FormData, guide user.\n    if (error instanceof SyntaxError && request.headers.get('content-type')?.includes('multipart/form-data')) {\n        return NextResponse.json({ message: 'For file uploads, use FormData. This mock endpoint expects JSON with image URLs.' }, { status: 400 });\n    }\n    return NextResponse.json({ message: 'Error creating progress note' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}