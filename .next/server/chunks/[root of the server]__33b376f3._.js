module.exports = {

"[project]/.next-internal/server/app/api/upload/image/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/@opentelemetry/api [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@opentelemetry/api", () => require("@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/child_process [external] (child_process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/tty [external] (tty, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/node:events [external] (node:events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}}),
"[externals]/node:process [external] (node:process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}}),
"[externals]/node:util [external] (node:util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[project]/src/lib/mockData.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "mockAppointments": (()=>mockAppointments),
    "mockInvoices": (()=>mockInvoices),
    "mockPatients": (()=>mockPatients),
    "mockProgressNotes": (()=>mockProgressNotes),
    "mockStaff": (()=>mockStaff),
    "mockTreatmentPlans": (()=>mockTreatmentPlans)
});
const mockPatients = [
    {
        id: 'pat1',
        name: 'Alice Wonderland',
        email: 'alice@example.com',
        dateOfBirth: '1990-05-15',
        phone: '555-0101'
    },
    {
        id: 'pat2',
        name: 'Bob The Builder',
        email: 'bob@example.com',
        dateOfBirth: '1985-11-20',
        phone: '555-0102'
    },
    {
        id: 'pat3',
        name: 'Charlie Brown',
        email: 'charlie@example.com',
        dateOfBirth: '2000-01-30',
        phone: '555-0103'
    }
];
const mockStaff = [
    {
        id: 'doc1',
        name: 'Dr. Loji',
        role: 'Dentist',
        email: 'drloji@example.com'
    },
    {
        id: 'staff1',
        name: 'Sarah Miller',
        role: 'Receptionist',
        email: 'sarah@example.com'
    },
    {
        id: 'hyg1',
        name: 'Mike Ross',
        role: 'Hygienist',
        email: 'mike@example.com'
    }
];
const mockAppointments = [
    {
        id: 'apt1',
        patientId: 'pat1',
        patientName: 'Alice Wonderland',
        doctorId: 'doc1',
        doctorName: 'Dr. Loji',
        date: new Date().toISOString().split('T')[0],
        time: '10:00 AM',
        type: 'Check-up',
        status: 'Scheduled'
    },
    {
        id: 'apt2',
        patientId: 'pat2',
        patientName: 'Bob The Builder',
        doctorId: 'doc1',
        doctorName: 'Dr. Loji',
        date: new Date(Date.now() + 86400000).toISOString().split('T')[0],
        time: '02:30 PM',
        type: 'Cleaning',
        status: 'Confirmed'
    },
    {
        id: 'apt3',
        patientId: 'pat1',
        patientName: 'Alice Wonderland',
        doctorId: 'doc1',
        doctorName: 'Dr. Loji',
        date: new Date(Date.now() - 86400000 * 5).toISOString().split('T')[0],
        time: '09:00 AM',
        type: 'Filling',
        status: 'Completed'
    }
];
const mockTreatmentPlans = [
    {
        id: 'tp1',
        patientId: 'pat1',
        doctorId: 'doc1',
        title: 'Comprehensive Oral Care Plan',
        procedures: [
            {
                id: 'proc1',
                name: 'Full Mouth X-Ray',
                cost: 150
            },
            {
                id: 'proc2',
                name: 'Deep Cleaning (Scaling & Root Planing)',
                cost: 400
            },
            {
                id: 'proc3',
                name: 'Fluoride Treatment',
                cost: 50
            }
        ],
        startDate: new Date(Date.now() - 86400000 * 10).toISOString().split('T')[0],
        status: 'Active',
        totalCost: 600
    },
    {
        id: 'tp2',
        patientId: 'pat2',
        doctorId: 'doc1',
        title: 'Implant Placement - Phase 1',
        procedures: [
            {
                id: 'proc4',
                name: 'Dental Implant Surgery (Single Tooth)',
                cost: 2000
            }
        ],
        startDate: new Date().toISOString().split('T')[0],
        status: 'Active',
        totalCost: 2000
    }
];
const mockProgressNotes = [
    {
        id: 'pn1',
        patientId: 'pat1',
        treatmentPlanId: 'tp1',
        doctorId: 'doc1',
        date: new Date(Date.now() - 86400000 * 9).toISOString().split('T')[0],
        time: '10:30 AM',
        note: 'Initial consultation. Discussed treatment plan. Patient agreeable. Full mouth X-rays taken.',
        images: [
            {
                id: 'img1',
                url: 'https://placehold.co/300x200.png',
                caption: 'X-Ray Left Side'
            }
        ],
        progressStage: 'Initial Assessment'
    },
    {
        id: 'pn2',
        patientId: 'pat1',
        treatmentPlanId: 'tp1',
        doctorId: 'doc1',
        date: new Date(Date.now() - 86400000 * 2).toISOString().split('T')[0],
        time: '11:00 AM',
        note: 'Deep cleaning performed on upper quadrant. Patient tolerated well. Advised on post-op care.',
        progressStage: 'Procedure Day 1'
    }
];
const mockInvoices = [
    {
        id: 'inv1',
        patientId: 'pat1',
        date: new Date(Date.now() - 86400000 * 10).toISOString().split('T')[0],
        dueDate: new Date(Date.now() + 86400000 * 20).toISOString().split('T')[0],
        items: [
            {
                description: 'Full Mouth X-Ray',
                quantity: 1,
                unitPrice: 150,
                totalPrice: 150
            },
            {
                description: 'Deep Cleaning (Scaling & Root Planing)',
                quantity: 1,
                unitPrice: 400,
                totalPrice: 400
            }
        ],
        totalAmount: 550,
        amountPaid: 200,
        status: 'Partial'
    },
    {
        id: 'inv2',
        patientId: 'pat2',
        date: new Date().toISOString().split('T')[0],
        dueDate: new Date(Date.now() + 86400000 * 30).toISOString().split('T')[0],
        items: [
            {
                description: 'Dental Implant Surgery (Single Tooth) - Deposit',
                quantity: 1,
                unitPrice: 1000,
                totalPrice: 1000
            }
        ],
        totalAmount: 1000,
        amountPaid: 0,
        status: 'Pending'
    }
];
}}),
"[project]/src/lib/mockServerDb.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
// src/lib/mockServerDb.ts
__turbopack_context__.s({
    "authorize": (()=>authorize),
    "db": (()=>db),
    "generateId": (()=>generateId)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/mockData.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
;
;
// Simulating a "database" in memory
const users = [];
// Make copies of imported arrays so we can mutate them
// Update patients to include new fields, ensuring they can be undefined initially
let patients = JSON.parse(JSON.stringify(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mockPatients"].map((p)=>({
        ...p,
        userId: users.find((u)=>u.email === p.email)?.id || p.id,
        age: p.dateOfBirth ? new Date().getFullYear() - new Date(p.dateOfBirth).getFullYear() : undefined,
        medicalRecords: undefined,
        xrayImageUrls: [],
        hasDiabetes: false,
        hasHighBloodPressure: false,
        hasStrokeOrHeartAttackHistory: false,
        hasBleedingDisorders: false,
        hasAllergy: false,
        allergySpecifics: undefined,
        hasAsthma: false
    }))));
let appointments = JSON.parse(JSON.stringify(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mockAppointments"]));
let treatmentPlans = JSON.parse(JSON.stringify(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mockTreatmentPlans"]));
let progressNotes = JSON.parse(JSON.stringify(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mockProgressNotes"]));
let invoices = JSON.parse(JSON.stringify(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mockInvoices"]));
let staff = JSON.parse(JSON.stringify(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mockStaff"])); // Initialize staff array
let clinicWaitTime = {
    text: "<10 mins",
    updatedAt: new Date().toISOString()
};
const db = {
    users,
    patients,
    appointments,
    treatmentPlans,
    progressNotes,
    invoices,
    clinicWaitTime,
    staff
};
function generateId(prefix = 'id_') {
    return prefix + Math.random().toString(36).substr(2, 9);
}
async function authorize(req, requiredRole) {
    const mockSessionToken = req.cookies.get('sessionToken')?.value;
    if (!mockSessionToken) {
        return {
            authorized: false,
            user: null,
            error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Unauthorized: No session token'
            }, {
                status: 401
            })
        };
    }
    const [userId, userRoleFromToken] = mockSessionToken.split(':');
    const user = db.users.find((u)=>u.id === userId && u.role === userRoleFromToken);
    // In a real scenario, you'd fetch user from actual DB by session.
    if (!user) {
        return {
            authorized: false,
            user: null,
            error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Unauthorized: Invalid session'
            }, {
                status: 401
            })
        };
    }
    const rolesToCheck = Array.isArray(requiredRole) ? requiredRole : requiredRole ? [
        requiredRole
    ] : [];
    if (rolesToCheck.length > 0 && !rolesToCheck.includes(user.role)) {
        // Allow doctors to access staff routes as a special case
        if (user.role === 'doctor' && rolesToCheck.includes('staff')) {
        // This is fine
        } else {
            return {
                authorized: false,
                user: null,
                error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    message: 'Forbidden: Insufficient permissions'
                }, {
                    status: 403
                })
            };
        }
    }
    return {
        authorized: true,
        user: user,
        error: null
    };
}
}}),
"[project]/src/app/api/upload/image/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
// src/app/api/upload/image/route.ts
__turbopack_context__.s({
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2d$cloud$2f$storage$2f$build$2f$esm$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@google-cloud/storage/build/esm/src/index.js [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2d$cloud$2f$storage$2f$build$2f$esm$2f$src$2f$storage$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@google-cloud/storage/build/esm/src/storage.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockServerDb$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/mockServerDb.ts [app-route] (ecmascript)"); // Using this for unique filenames
;
;
;
// Initialize GCS Storage client
// It will automatically use credentials from GOOGLE_APPLICATION_CREDENTIALS environment variable
let storage;
try {
    storage = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2d$cloud$2f$storage$2f$build$2f$esm$2f$src$2f$storage$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Storage"]();
} catch (error) {
    console.error("Failed to initialize Google Cloud Storage client:", error);
// If storage client fails to initialize, subsequent calls will fail.
// Consider how to handle this globally or per request.
}
const GCS_BUCKET_NAME = process.env.GCS_BUCKET_NAME;
async function POST(request) {
    if (!storage) {
        console.error('GCS Storage client not initialized. Check GOOGLE_APPLICATION_CREDENTIALS.');
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: "Server configuration error for file uploads."
        }, {
            status: 500
        });
    }
    if (!GCS_BUCKET_NAME) {
        console.error('GCS_BUCKET_NAME environment variable is not set.');
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: "Server configuration error: Bucket name missing."
        }, {
            status: 500
        });
    }
    try {
        const formData = await request.formData();
        const file = formData.get('imageFile');
        if (!file) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: "No file provided"
            }, {
                status: 400
            });
        }
        // Updated file type validation
        const allowedTypes = [
            'image/jpeg',
            'image/png',
            'image/webp',
            'image/gif',
            'application/pdf'
        ];
        if (!allowedTypes.includes(file.type)) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: `Invalid file type: ${file.type}. Allowed types: JPG, PNG, WEBP, GIF, PDF.`
            }, {
                status: 400
            });
        }
        // Basic file size validation (e.g., 5MB limit)
        const maxSizeInBytes = 5 * 1024 * 1024; // 5MB
        if (file.size > maxSizeInBytes) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: `File too large. Maximum size is ${maxSizeInBytes / (1024 * 1024)}MB.`
            }, {
                status: 400
            });
        }
        const bytes = await file.arrayBuffer();
        const buffer = Buffer.from(bytes);
        // Generate a unique filename to prevent overwrites
        const uniqueFilename = `${(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mockServerDb$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"])('gcsfile_')}-${file.name.replace(/\s+/g, '_')}`;
        const bucket = storage.bucket(GCS_BUCKET_NAME);
        const gcsFile = bucket.file(uniqueFilename);
        await gcsFile.save(buffer, {
            metadata: {
                contentType: file.type
            }
        });
        // IMPORTANT: Ensure your bucket or the specific object has public read access
        // if you intend to use this direct URL format.
        // Otherwise, you'd need to generate signed URLs.
        // If you set `public: true` above AND your bucket allows public access, this URL should work.
        const publicUrl = `https://storage.googleapis.com/${GCS_BUCKET_NAME}/${uniqueFilename}`;
        console.log(`File ${file.name} uploaded to ${GCS_BUCKET_NAME}/${uniqueFilename}. Public URL: ${publicUrl}`);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: "File uploaded successfully to GCS",
            imageUrl: publicUrl,
            fileName: uniqueFilename // Return the GCS filename
        }, {
            status: 201
        });
    } catch (error) {
        console.error('GCS File upload error:', error);
        // Check if error is from GCS and provide more specific feedback if possible
        if (error instanceof Error && 'code' in error && error.code === 403) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: "Permission denied. Check GCS bucket/service account permissions."
            }, {
                status: 403
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: "An unexpected error occurred during file upload to GCS"
        }, {
            status: 500
        });
    }
}
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__33b376f3._.js.map